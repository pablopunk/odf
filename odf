#!/bin/bash

repo="$( git rev-parse --show-toplevel )"     # absolute path
repo="$( realpath $repo --relative-to=$PWD )" # relative path

# Files to be opened:
##Â Modified files ignored deleted
## New untracked files
files=$( {\
  ( git diff -w | grep "^+++ b" | sed 's,+++ b/,,' ) ; \
  ( git status --porcelain | grep "??" | sed s/^??\ // ) \
} )

# Use provided editor, 'echo' as default
if [ $# -eq 1 ]; then
  editor=$1
else
  editor=echo
fi

# For vi/vim/nvim open one tab per file
if [[ "$editor" == *"vi"* ]]; then
  editor="$editor -p"
fi

# Add repo on spaces
files="$(echo $files | sed "s@ @ $repo/@g")"

# odf. Notice the first file was not prepended with repo
$editor $repo/$files
