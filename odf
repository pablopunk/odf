#!/bin/bash

# Get the absolute path of the top-level directory of the Git repository
repo_abs_path="$(git rev-parse --show-toplevel)"
# Convert to relative path, handling spaces correctly
repo_rel_path="$(realpath --relative-to="$PWD" "$repo_abs_path" 2>/dev/null || echo "$repo_abs_path")"

# Initialize an array to store file paths
files=()

# Fill the array with modified and new untracked file paths, trimming whitespace
while IFS= read -r line; do
  trimmed_line=$(echo "$line" | xargs)  # Trim leading and trailing whitespace
  files+=("$repo_rel_path/$trimmed_line")
done < <( \
  git diff -w | grep "^+++ b" | sed 's,+++ b/,,' ; \
  git status --porcelain | grep "??" | sed 's/^?? //' \
)

# Determine the editor to use
if [ $# -gt 0 ]; then
  editor="$@"
else
  editor="echo"
fi

# Open files with the editor if there are any files to open
if [ ${#files[@]} -gt 0 ]; then
  "$editor" "${files[@]}"
fi

